# ImageMediaType æšä¸¾é‡æ„è¯´æ˜

## é‡æ„æ¦‚è¿°

å¯¹ `ImageMediaType` æšä¸¾è¿›è¡Œäº†é‡å¤§é‡æ„ï¼Œæ·»åŠ äº†æ–‡ä»¶æ‰©å±•åå±æ€§å’Œå››ä¸ªæ–°çš„å·¥å…·æ–¹æ³•ï¼Œä½¿å…¶èƒ½å¤Ÿæ›´æ–¹ä¾¿åœ°åœ¨ Content-Type å’Œæ–‡ä»¶æ‰©å±•åä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚

## å˜æ›´å†…å®¹

### 1. æšä¸¾ç»“æ„å˜æ›´

#### æ–°å¢å±æ€§

ä¸ºæ¯ä¸ªæšä¸¾å€¼æ·»åŠ äº† `extension` å±æ€§ï¼š

```java
// ä¿®æ”¹å‰
PNG("image/png")

// ä¿®æ”¹å
PNG("image/png", ".png")
```

#### æ–°å¢ Getter æ–¹æ³•

```java
public String getContentType()          // è·å– Content-Type
public String getExtension()            // è·å–æ–‡ä»¶æ‰©å±•åï¼ˆåŒ…å«ç‚¹å·ï¼Œå¦‚ ".png"ï¼‰
public String getExtensionWithoutDot()  // è·å–æ–‡ä»¶æ‰©å±•åï¼ˆä¸åŒ…å«ç‚¹å·ï¼Œå¦‚ "png"ï¼‰
```

### 2. æ–°å¢å·¥å…·æ–¹æ³•

#### æ–¹æ³• 1: fromContentType(String contentType)

**åŠŸèƒ½**ï¼šé€šè¿‡ Content-Type è·å–æšä¸¾

```java
ImageMediaType type = ImageMediaType.fromContentType("image/jpeg");
// è¿”å›: ImageMediaType.JPEG

ImageMediaType type = ImageMediaType.fromContentType("image/jpeg; charset=utf-8");
// è¿”å›: ImageMediaType.JPEG (è‡ªåŠ¨å¤„ç†é¢å¤–å‚æ•°)

ImageMediaType type = ImageMediaType.fromContentType("image/jpg");
// è¿”å›: ImageMediaType.JPEG (å¤„ç†åˆ«å)
```

**ç‰¹æ€§**ï¼š

- è‡ªåŠ¨å¤„ç† Content-Type ä¸­çš„é¢å¤–å‚æ•°ï¼ˆå¦‚ `charset`ï¼‰
- æ”¯æŒå¸¸è§åˆ«åï¼ˆå¦‚ `image/jpg` â†’ `image/jpeg`ï¼‰
- å¤§å°å†™ä¸æ•æ„Ÿ
- æ‰¾ä¸åˆ°åŒ¹é…é¡¹æ—¶è¿”å› `null`

#### æ–¹æ³• 2: fromExtension(String extension)

**åŠŸèƒ½**ï¼šé€šè¿‡æ–‡ä»¶åç¼€è·å–æšä¸¾

```java
ImageMediaType type = ImageMediaType.fromExtension(".png");
// è¿”å›: ImageMediaType.PNG

ImageMediaType type = ImageMediaType.fromExtension("png");
// è¿”å›: ImageMediaType.PNG (è‡ªåŠ¨æ·»åŠ ç‚¹å·)

ImageMediaType type = ImageMediaType.fromExtension(".jpeg");
// è¿”å›: ImageMediaType.JPEG (å¤„ç†åˆ«åï¼Œæ ‡å‡†åŒ–ä¸º .jpg)
```

**ç‰¹æ€§**ï¼š

- æ”¯æŒå¸¦æˆ–ä¸å¸¦ç‚¹å·çš„æ‰©å±•å
- è‡ªåŠ¨å¤„ç†å¸¸è§åˆ«åï¼ˆ`.jpeg`, `.jfif`, `.pjpeg` â†’ `.jpg`ï¼‰
- å¤§å°å†™ä¸æ•æ„Ÿ
- æ‰¾ä¸åˆ°åŒ¹é…é¡¹æ—¶è¿”å› `null`

#### æ–¹æ³• 3: getExtensionByContentType(String contentType)

**åŠŸèƒ½**ï¼šé€šè¿‡ Content-Type è·å–æ–‡ä»¶æ‰©å±•å

```java
String ext = ImageMediaType.getExtensionByContentType("image/jpeg");
// è¿”å›: ".jpg"

String ext = ImageMediaType.getExtensionByContentType("image/png; charset=utf-8");
// è¿”å›: ".png"

String ext = ImageMediaType.getExtensionByContentType("image/unknown");
// è¿”å›: null
```

**ç‰¹æ€§**ï¼š

- è¿”å›æ ‡å‡†æ‰©å±•åï¼ˆåŒ…å«ç‚¹å·ï¼‰
- è‡ªåŠ¨å¤„ç† Content-Type å‚æ•°
- æ‰¾ä¸åˆ°åŒ¹é…é¡¹æ—¶è¿”å› `null`

#### æ–¹æ³• 4: getContentTypeByExtension(String extension)

**åŠŸèƒ½**ï¼šé€šè¿‡æ–‡ä»¶åç¼€è·å– Content-Type

```java
String contentType = ImageMediaType.getContentTypeByExtension(".png");
// è¿”å›: "image/png"

String contentType = ImageMediaType.getContentTypeByExtension("jpeg");
// è¿”å›: "image/jpeg"

String contentType = ImageMediaType.getContentTypeByExtension(".unknown");
// è¿”å›: null
```

**ç‰¹æ€§**ï¼š

- æ”¯æŒå¸¦æˆ–ä¸å¸¦ç‚¹å·çš„æ‰©å±•å
- è‡ªåŠ¨å¤„ç†åˆ«å
- æ‰¾ä¸åˆ°åŒ¹é…é¡¹æ—¶è¿”å› `null`

#### æ–¹æ³• 5: getExtensionWithoutDotByContentType(String contentType)

**åŠŸèƒ½**ï¼šé€šè¿‡ Content-Type è·å–ä¸åŒ…å«ç‚¹å·çš„æ–‡ä»¶æ‰©å±•å

```java
String ext = ImageMediaType.getExtensionWithoutDotByContentType("image/jpeg");
// è¿”å›: "jpg"

String ext = ImageMediaType.getExtensionWithoutDotByContentType("image/png; charset=utf-8");
// è¿”å›: "png"

String ext = ImageMediaType.getExtensionWithoutDotByContentType("image/unknown");
// è¿”å›: null
```

**ç‰¹æ€§**ï¼š

- è¿”å›ä¸åŒ…å«ç‚¹å·çš„æ ‡å‡†æ‰©å±•å
- è‡ªåŠ¨å¤„ç† Content-Type å‚æ•°
- æ‰¾ä¸åˆ°åŒ¹é…é¡¹æ—¶è¿”å› `null`

#### æ–¹æ³• 6: getStandardExtensionWithoutDot(String extension)

**åŠŸèƒ½**ï¼šé€šè¿‡æ–‡ä»¶åç¼€è·å–æ ‡å‡†çš„ä¸åŒ…å«ç‚¹å·çš„æ‰©å±•å

```java
String ext = ImageMediaType.getStandardExtensionWithoutDot(".png");
// è¿”å›: "png"

String ext = ImageMediaType.getStandardExtensionWithoutDot(".jpeg");
// è¿”å›: "jpg" (æ ‡å‡†åŒ–ä¸º jpg)

String ext = ImageMediaType.getStandardExtensionWithoutDot("webp");
// è¿”å›: "webp" (è‡ªåŠ¨æ·»åŠ ç‚¹å·åå†å¤„ç†)

String ext = ImageMediaType.getStandardExtensionWithoutDot(".unknown");
// è¿”å›: null
```

**ç‰¹æ€§**ï¼š

- è¿”å›æ ‡å‡†åŒ–çš„æ‰©å±•åï¼ˆä¸åŒ…å«ç‚¹å·ï¼‰
- è‡ªåŠ¨å¤„ç†åˆ«åï¼ˆå¦‚ `.jpeg` â†’ `jpg`ï¼‰
- æ”¯æŒå¸¦æˆ–ä¸å¸¦ç‚¹å·çš„è¾“å…¥
- æ‰¾ä¸åˆ°åŒ¹é…é¡¹æ—¶è¿”å› `null`

### 3. å…¼å®¹æ€§å¤„ç†

æ—§æ–¹æ³•è¢«æ ‡è®°ä¸º `@Deprecated`ï¼Œä½†ä»ç„¶å¯ç”¨ï¼š

```java
@Deprecated
public static String fromExtension(String extension, String defaultContentType)

@Deprecated
public static String fromFileName(String filename)

@Deprecated
public static String fromFileName(String filename, String defaultContentType)
```

**å»ºè®®è¿ç§»æ–¹å¼**ï¼š

```java
// æ—§ä»£ç 
String contentType = ImageMediaType.fromExtension(".png", "application/octet-stream");

// æ–°ä»£ç 
String contentType = ImageMediaType.getContentTypeByExtension(".png");
if (contentType == null) {
    contentType = "application/octet-stream";
}
// æˆ–ä½¿ç”¨ Optional
String contentType = Optional.ofNullable(ImageMediaType.getContentTypeByExtension(".png"))
    .orElse("application/octet-stream");
```

## é‡æ„åçš„ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1: ä¸‹è½½ç½‘ç»œå›¾ç‰‡æ—¶æ¨æ–­æ‰©å±•å

**é‡æ„å‰**ï¼ˆ`ImageDownloadHandler.getExtensionFromContentType`ï¼‰ï¼š

```java
private String getExtensionFromContentType(String contentType) {
    if (contentType == null || contentType.isEmpty()) {
        return null;
    }
    String mimeType = contentType.split(";")[0].trim().toLowerCase();
    return switch (mimeType) {
        case "image/jpeg", "image/jpg" -> ".jpg";
        case "image/png" -> ".png";
        // ... æ›´å¤š case
        default -> null;
    };
}
```

**é‡æ„å**ï¼š

```java
private String getExtensionFromContentType(String contentType) {
    return ImageMediaType.getExtensionByContentType(contentType);
}
```

### åœºæ™¯ 2: è·å–æ–‡ä»¶çš„ Content-Type

**é‡æ„å‰**ï¼š

```java
String contentType = switch (extension.toLowerCase()) {
    case ".jpg", ".jpeg" -> "image/jpeg";
    case ".png" -> "image/png";
    // ... æ›´å¤š case
    default -> "application/octet-stream";
};
```

**é‡æ„å**ï¼š

```java
String contentType = Optional.ofNullable(ImageMediaType.getContentTypeByExtension(extension))
    .orElse("application/octet-stream");
```

### åœºæ™¯ 3: éªŒè¯æ–‡ä»¶ç±»å‹

**æ–°åŠŸèƒ½**ï¼š

```java
// æ£€æŸ¥æ˜¯å¦æ˜¯æœ‰æ•ˆçš„å›¾ç‰‡æ‰©å±•å
ImageMediaType type = ImageMediaType.fromExtension(extension);
if (type != null) {
    // æ˜¯æ”¯æŒçš„å›¾ç‰‡æ ¼å¼
    System.out.println("Content-Type: " + type.getContentType());
    System.out.println("æ ‡å‡†æ‰©å±•å: " + type.getExtension());
}

// æ£€æŸ¥ Content-Type æ˜¯å¦æ˜¯å›¾ç‰‡
ImageMediaType type = ImageMediaType.fromContentType(contentType);
if (type != null) {
    // æ˜¯æ”¯æŒçš„å›¾ç‰‡ç±»å‹
}
```

## æ”¯æŒçš„æ‰©å±•ååˆ«å

ä»¥ä¸‹åˆ«åä¼šè¢«è‡ªåŠ¨æ ‡å‡†åŒ–ï¼š

| åˆ«å                                 | æ ‡å‡†æ‰©å±•å   | Content-Type |
|------------------------------------|---------|--------------|
| `.jpeg`, `.jfif`, `.pjpeg`, `.jpe` | `.jpg`  | `image/jpeg` |
| `.tif`                             | `.tiff` | `image/tiff` |

## æ”¯æŒçš„ Content-Type åˆ«å

| åˆ«å          | æ ‡å‡† Content-Type |
|-------------|-----------------|
| `image/jpg` | `image/jpeg`    |
| `image/svg` | `image/svg+xml` |

## æ‰€æœ‰æ”¯æŒçš„å›¾ç‰‡æ ¼å¼

### å¸¸è§ Web æ ¼å¼

| æ ¼å¼   | Content-Type    | æ‰©å±•å     |
|------|-----------------|---------|
| JPEG | `image/jpeg`    | `.jpg`  |
| PNG  | `image/png`     | `.png`  |
| GIF  | `image/gif`     | `.gif`  |
| WebP | `image/webp`    | `.webp` |
| BMP  | `image/bmp`     | `.bmp`  |
| SVG  | `image/svg+xml` | `.svg`  |
| ICO  | `image/x-icon`  | `.ico`  |
| TIFF | `image/tiff`    | `.tiff` |

### ç°ä»£æ ¼å¼

| æ ¼å¼   | Content-Type | æ‰©å±•å     |
|------|--------------|---------|
| AVIF | `image/avif` | `.avif` |
| HEIC | `image/heic` | `.heic` |
| HEIF | `image/heif` | `.heif` |

### JPEG 2000 ç³»åˆ—

| æ ¼å¼  | Content-Type | æ‰©å±•å    |
|-----|--------------|--------|
| JP2 | `image/jp2`  | `.jp2` |
| JPX | `image/jpx`  | `.jpx` |
| JPM | `image/jpm`  | `.jpm` |

### å…¶ä»–æ ¼å¼

æ”¯æŒ 40+ ç§å›¾ç‰‡æ ¼å¼ï¼ŒåŒ…æ‹¬å„ç§ä¸“ä¸šå’Œè¡Œä¸šæ ‡å‡†æ ¼å¼ã€‚

## æµ‹è¯•å»ºè®®

### å•å…ƒæµ‹è¯•ç”¨ä¾‹

```java
@Test
public void testFromContentType() {
    // åŸºæœ¬æµ‹è¯•
    assertEquals(ImageMediaType.JPEG, ImageMediaType.fromContentType("image/jpeg"));
    assertEquals(ImageMediaType.PNG, ImageMediaType.fromContentType("image/png"));
    
    // å¤„ç†é¢å¤–å‚æ•°
    assertEquals(ImageMediaType.JPEG, ImageMediaType.fromContentType("image/jpeg; charset=utf-8"));
    
    // å¤„ç†åˆ«å
    assertEquals(ImageMediaType.JPEG, ImageMediaType.fromContentType("image/jpg"));
    
    // å¤§å°å†™ä¸æ•æ„Ÿ
    assertEquals(ImageMediaType.PNG, ImageMediaType.fromContentType("IMAGE/PNG"));
    
    // æœªçŸ¥ç±»å‹
    assertNull(ImageMediaType.fromContentType("image/unknown"));
}

@Test
public void testFromExtension() {
    // åŸºæœ¬æµ‹è¯•
    assertEquals(ImageMediaType.PNG, ImageMediaType.fromExtension(".png"));
    assertEquals(ImageMediaType.PNG, ImageMediaType.fromExtension("png"));
    
    // å¤„ç†åˆ«å
    assertEquals(ImageMediaType.JPEG, ImageMediaType.fromExtension(".jpeg"));
    assertEquals(ImageMediaType.JPEG, ImageMediaType.fromExtension(".jfif"));
    
    // å¤§å°å†™ä¸æ•æ„Ÿ
    assertEquals(ImageMediaType.GIF, ImageMediaType.fromExtension(".GIF"));
    
    // æœªçŸ¥ç±»å‹
    assertNull(ImageMediaType.fromExtension(".unknown"));
}

@Test
public void testGetExtensionByContentType() {
    assertEquals(".jpg", ImageMediaType.getExtensionByContentType("image/jpeg"));
    assertEquals(".png", ImageMediaType.getExtensionByContentType("image/png"));
    assertNull(ImageMediaType.getExtensionByContentType("image/unknown"));
}

@Test
public void testGetContentTypeByExtension() {
    assertEquals("image/png", ImageMediaType.getContentTypeByExtension(".png"));
    assertEquals("image/jpeg", ImageMediaType.getContentTypeByExtension("jpg"));
    assertNull(ImageMediaType.getContentTypeByExtension(".unknown"));
}
```

## è¿ç§»æŒ‡å—

### æ­¥éª¤ 1: è¯†åˆ«æ—§ä»£ç 

æœç´¢ä»¥ä¸‹æ¨¡å¼ï¼š

- æ‰‹å†™çš„ Content-Type åˆ¤æ–­ switch/if è¯­å¥
- `ImageMediaType.fromExtension(ext, default)` å¸¦é»˜è®¤å€¼çš„è°ƒç”¨
- `ImageMediaType.fromFileName(filename)` è°ƒç”¨

### æ­¥éª¤ 2: è¯„ä¼°è¿ç§»ä¼˜å…ˆçº§

**é«˜ä¼˜å…ˆçº§**ï¼š

- æ–°åŠŸèƒ½å¼€å‘
- æ­£åœ¨ä¿®æ”¹çš„ä»£ç 
- å­˜åœ¨é‡å¤é€»è¾‘çš„åœ°æ–¹

**ä½ä¼˜å…ˆçº§**ï¼š

- ç¨³å®šè¿è¡Œçš„æ—§ä»£ç 
- ä¸å½±å“åŠŸèƒ½çš„åœ°æ–¹

### æ­¥éª¤ 3: é€æ­¥è¿ç§»

1. å…ˆè¿ç§»æ–°åŠŸèƒ½å’Œæ­£åœ¨ä¿®æ”¹çš„ä»£ç 
2. ä½¿ç”¨æ–°æ–¹æ³•ç®€åŒ–å¤æ‚çš„ç±»å‹åˆ¤æ–­é€»è¾‘
3. å®šæœŸæ¸…ç† deprecated æ–¹æ³•çš„ä½¿ç”¨

### æ­¥éª¤ 4: éªŒè¯

- ç¡®ä¿æ‰€æœ‰æµ‹è¯•é€šè¿‡
- éªŒè¯å›¾ç‰‡ä¸Šä¼ ã€ä¸‹è½½åŠŸèƒ½æ­£å¸¸
- æ£€æŸ¥æ–‡ä»¶ç±»å‹è¯†åˆ«æ˜¯å¦å‡†ç¡®

## å·²é‡æ„çš„ä»£ç 

âœ… **å·²å®Œæˆ**ï¼š

- `ImageDownloadHandler.getExtensionFromContentType()` - ä½¿ç”¨ `getExtensionByContentType()`

ğŸ“ **å¾…è¿ç§»**ï¼ˆä½ä¼˜å…ˆçº§ï¼Œå·²æ ‡è®°ä¸º @Deprecatedï¼‰ï¼š

- `ImageUtils.getImageType()` - ä½¿ç”¨ `fromFileName()`
- `BaiduBosUtils.getContentType()` - ä½¿ç”¨ `fromFileName()` å¸¦é»˜è®¤å€¼

## ä¼˜åŠ¿æ€»ç»“

### 1. ä»£ç ç®€åŒ–

- æ¶ˆé™¤äº†å¤§é‡é‡å¤çš„ switch è¯­å¥
- ç»Ÿä¸€çš„ç±»å‹è½¬æ¢é€»è¾‘
- æ›´æ¸…æ™°çš„ API è®¾è®¡

### 2. æ˜“äºç»´æŠ¤

- æ‰€æœ‰æ˜ å°„å…³ç³»é›†ä¸­åœ¨æšä¸¾ä¸­
- æ·»åŠ æ–°æ ¼å¼åªéœ€ä¿®æ”¹æšä¸¾å®šä¹‰
- å‡å°‘äº†é”™è¯¯å’Œé—æ¼çš„å¯èƒ½æ€§

### 3. åŠŸèƒ½å¢å¼º

- è‡ªåŠ¨å¤„ç†åˆ«å
- æ”¯æŒåŒå‘è½¬æ¢
- æ›´çµæ´»çš„ä½¿ç”¨æ–¹å¼

### 4. ç±»å‹å®‰å…¨

- ä½¿ç”¨æšä¸¾ç±»å‹è€Œä¸æ˜¯å­—ç¬¦ä¸²
- ç¼–è¯‘æ—¶æ£€æŸ¥
- IDE è‡ªåŠ¨è¡¥å…¨æ”¯æŒ

## ç‰ˆæœ¬ä¿¡æ¯

- **é‡æ„ç‰ˆæœ¬**: 2.0.0
- **é‡æ„æ—¥æœŸ**: 2025-11-02
- **å‘åå…¼å®¹**: æ˜¯ï¼ˆæ—§æ–¹æ³•æ ‡è®°ä¸º @Deprecatedï¼‰
- **ç ´åæ€§å˜æ›´**: æ— 

## ç›¸å…³æ–‡æ¡£

- [WebP ä¸Šä¼ é—®é¢˜ä¿®å¤](WEBP_UPLOAD_FIX.md)
- [å›¾ç‰‡ä¸‹è½½å®ç°](IMAGE_DOWNLOAD_IMPLEMENTATION.md)

