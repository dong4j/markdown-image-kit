# TODO

## 2025.12.11

使用 code vision 快速处理图片:

1. 转换为 webp
2. 上传到图床
3. 迁移到其他图床
4. 替换为 `<a>` 标签
5. 添加水印
6. 下载到本地

## 2025.10.26

在收集了多个用户的需求后, 从 2.0.x 开始, 侧重于在 IDE 中处理图片, 就像 Typora 一样, 图片上传只是附带的一个增强功能而已, 所以会重构设置页面,
将图片处理放在首位, 然后是图片的增强处理, 比如图片压缩, 转为 webp, 添加水印等, 最后才是上传服务:

![img.png](./imgs/typora.png)

## 插入图片时...

**下拉选项**

1. 无特殊操作: 使用 IDE 原生操作

2. 复制图片到当前文件夹 (`./`): 现有逻辑可支持

3. 复制图片到 `./assets` 文件夹: 现有逻辑可支持

4. 复制图片到 `./${filename}.assets` 文件夹: 在现有逻辑中增加占位符解析

5. 上传图片: 直接从剪切板上传(现在的 **上传图片并替换**)

6. 复制到指定路径:

   自定义路径: 请输入相对路径（以：`./` 或 `../` 开头）或绝对路径。（其中 `${filename}` 表示当前文件名）

   需要支持 `${project}` 占位符, 用于保存到当前项目下的某个目录

---

**复选框:**

1. 对本地位置的图片应用上述规则
2. 对网络位置的图片应用上述规则: 在合法的 markdown 图片标签中, 如果粘贴的是网络图片, 则会直接下载到执行的目录中

## 图片语法偏好

优先使用相对路径

![image-20251031190700713](/Users/dong4j/Developer/0.Worker/opensource/idea/mik/markdown-image-kit/imgs//image-20251031190700713.png)

复制到绝对路径是, 在未开启 **优先使用相对路径** 时, 图片会是全路径格式:

```
![image-20251031190700713](/Users/dong4j/Developer/0.Worker/opensource/idea/mik/markdown-image-kit/imgs//image-20251031190700713.png)
```

![image-20251031190751433](imgs//image-20251031190751433.png)

开启 **优先使用相对路径** 时, 图片会是相对径格式:

```
![image-20251031190751433](imgs//image-20251031190751433.png)
```

![image-20251031190805901](./imgs//image-20251031190805901.png)

开启 **优先使用相对路径** 且 开启 **为相对路径添加 `./`** 时, 会自动添加 `./`:

```
![image-20251031190805901](./imgs//image-20251031190805901.png)
```

## 图片处理

1. 替换为 `<a>` 标签
    1. 正常
    2. 点击放大
    3. 自定义
2. 图片压缩
    1. 转为 WebP
3. 图片重命名
    1. 随机
    2. 文件名
    3. 时间戳+文件名
4. 添加水印

### 上传服务设定

1. 下拉列表选择服务商
2. 根据不同的服务商展示不同的输入框
3. 验证图片上传选项按钮: 发起上传测试请求
4. 帮助按钮

默认图床复选框: 如果配置多个服务商的话, 需要选择一个默认的服务商, 会在以下逻辑中使用:

1. `alt + enter`: `info.dong4j.idea.plugin.action.intention.ImageUploadIntentionAction`
2. 右键 **图片上传**:  `info.dong4j.idea.plugin.action.image.ImageUploadAction`


- [ ] 新特性
    - 图床迁移添加一个 迁移到本地的功能, 意思是将图床的图片下载到本地并替换为本地图片标签
      在图床迁移的下拉列表中,添加一个 本地存储 选项(保持为最后一个选项), 然后使用网络下载图片并替换标签(需要支持无图片后缀,
      有参数的网络图片[从响应中获取 content-type])
      可以将 本地存储 这个也作为一个 OSS 客户端, 可以兼容整个业务流程, 然后在本地存储的 OSS 客户端实现中, 将上传修改为下载即可,
      存储位置从设置页面读取(默认是 `./imgs`, 即当前 markdown 文件所在目录的 imgs 子目录中), 下载之后的文件名根据是否开启 图片重命名功能来生成
    - 支持 `file://` 协议的本地图片
    - 支持本地无后缀的图片, 那就需要通过获取文件的 magic code 来判断图片类型
    - 支持没有后缀的网络图片, 比如一些常见的添加了图片处理参数的 url(比如 `?x-0ss-process=image/resize,m_fixed,w_100,h_100`), 或图片 API
  - 图片重命名: 如果选择 `日期-文件名`, 则需要支持日期格式化, 比如 `${yyyy-mm-dd}-${number}-${filename}`; 选择随机的话也通过占位符来指定随机的字符和长度;
    - 支持 复制图片到项目根路径下的某个目录: `$(project_path)/static/imgs/${filename}` 意思是增强现在的复制图片的功能, 支持绝对路径 (如果
      IDE 支持的话)
    - 类 Typora 功能: 复制到指定目录: 输入相对路径(以 `./` 或 `../` 开头) 或绝对路径, `${filename}` 表示 markdown 文件名

![](./imgs/1762000794174img.webp)

![image-20251101205635926](./imgs/image-20251101205635926.png)

## 2025.12.15 - 实用功能建议

### 图片管理和清理

- [ ] **检测未使用的图片**: 扫描项目中的图片文件, 检测哪些图片没有被任何 Markdown 文件引用, 支持批量删除
  右键菜单中添加这个功能
- [ ] **图片重复检测**: 通过 MD5 或图片内容相似度检测重复图片, 支持合并引用或删除重复文件
- [ ] **图片引用统计**: 显示每张图片被引用的次数和位置, 帮助了解图片使用情况
- [ ] **图片文件大小统计**: 显示所有图片的总大小, 按文件大小排序, 帮助识别需要优化的图片
- [ ] **清理断链图片**: 检测并清理 Markdown 中引用但文件不存在的图片标签
  右键菜单中添加这个功能

### 图片信息展示

- [ ] **图片信息提示**: 在编辑器中将鼠标悬停在图片标签上时, 显示图片尺寸、文件大小、格式等信息
- [ ] **图片 EXIF 信息提取**: 支持提取和显示图片的 EXIF 信息(拍摄时间、相机型号、GPS 等)
- [ ] **图片尺寸标注**: 在图片标签中自动添加尺寸信息, 如 `![image](path.png "800x600")`
- [ ] **图片加载状态**: 对于网络图片, 显示加载状态(加载中、加载失败、已加载)

### 图片批量操作增强

- [x] **批量下载网络图片**: 将文档中所有网络图片批量下载到本地指定目录
- [x] **批量压缩图片**: 对选中的多个图片或整个文档的图片进行批量压缩
- [x] **批量格式转换**: 批量将图片转换为指定格式(如全部转为 WebP)
- [x] **批量添加水印**: 对多个图片批量添加相同的水印
- [x] **批量重命名**: 按照统一规则批量重命名图片文件

### 图片优化和性能

- [ ] **自动压缩大图片**: 设置阈值, 自动压缩超过指定大小的图片
- [ ] **图片懒加载支持**: 生成支持懒加载的 HTML 标签, 如 `<img loading="lazy">`
- [ ] **响应式图片支持**: 生成响应式图片标签, 支持 `srcset` 和 `sizes` 属性
- [ ] **图片 CDN 加速**: 自动将图片 URL 替换为 CDN 加速地址
- [ ] **图片预加载**: 支持添加图片预加载标签 `<link rel="preload">`

### 图片编辑功能

- [ ] **图片尺寸调整**: 在编辑器中直接调整图片显示尺寸, 生成带尺寸参数的标签
- [ ] **图片裁剪**: 支持简单的图片裁剪功能, 裁剪后保存新文件
- [ ] **图片旋转**: 支持图片旋转(90度、180度、270度)
- [ ] **图片翻转**: 支持图片水平/垂直翻转
- [ ] **图片亮度/对比度调整**: 简单的图片亮度、对比度、饱和度调整

### 图片引用和链接管理

- [x] **图片引用跳转**: 点击图片标签时, 自动跳转到对应的图片文件位置
- [ ] **图片路径自动修复**: 检测并自动修复断链的图片路径
- [ ] **图片路径规范化**: 统一规范化图片路径格式, 修复路径中的错误
- [x] **相对路径自动转换**: 自动将绝对路径转换为相对路径(或相反)
- [ ] **图片链接验证**: 批量验证所有图片链接是否有效(本地文件是否存在, 网络图片是否可访问)

### 图片处理规则和自动化

- [x] **图片处理规则配置**: 配置自动处理规则, 如粘贴图片时自动压缩、自动上传等
- [ ] **图片处理历史记录**: 记录图片处理历史, 支持撤销操作
- [ ] **图片处理模板**: 保存常用的图片处理配置为模板, 快速应用
- [ ] **条件处理规则**: 根据图片大小、格式等条件自动应用不同的处理规则
- [ ] **图片处理工作流**: 定义图片处理工作流, 如: 压缩 -> 添加水印 -> 上传 -> 替换标签

### 图片预览和查看

- [ ] **图片预览弹窗**: 点击图片标签时, 在弹窗中预览大图
- [ ] **图片画廊模式**: 支持在文档中浏览所有图片, 类似图片画廊
- [ ] **图片对比查看**: 支持对比处理前后的图片效果
- [ ] **图片缩略图生成**: 自动生成图片缩略图, 用于快速预览
- [ ] **图片幻灯片模式**: 支持全屏幻灯片模式查看文档中的所有图片

### 图片格式转换增强

- [ ] **支持更多格式转换**: 除了 WebP, 支持转换为 AVIF、HEIC 等新格式
- [ ] **智能格式选择**: 根据图片内容自动选择最佳格式
- [ ] **格式转换质量预设**: 提供多种质量预设(高质量、标准、压缩)
- [ ] **批量格式转换进度**: 显示批量转换的进度和结果统计
- [ ] **格式转换前预览**: 转换前预览转换效果和文件大小对比

### 图片安全和隐私

- [ ] **图片敏感信息清理**: 自动清理图片中的 EXIF 敏感信息(如 GPS 位置)
- [ ] **图片访问权限控制**: 对于上传到图床的图片, 支持设置访问权限
- [ ] **图片加密上传**: 支持加密上传图片到图床
- [ ] **图片水印防盗**: 自动添加防盗水印, 包含来源信息
- [ ] **图片访问统计**: 统计网络图片的访问次数和来源

### 图片协作和分享

- [ ] **图片版本管理**: 支持图片的版本管理, 记录修改历史
- [ ] **图片分享链接生成**: 快速生成图片的分享链接
- [ ] **图片批量导出**: 将文档中的所有图片导出到指定目录
- [ ] **图片导入**: 从指定目录批量导入图片并自动插入到文档
- [ ] **图片同步**: 支持在不同设备间同步图片配置和处理规则

### 图片智能功能

- [ ] **图片 OCR 文字识别**: 识别图片中的文字, 自动添加到 alt 文本中
- [ ] **图片内容分析**: 分析图片内容, 自动生成描述性的 alt 文本
- [ ] **图片相似度检测**: 检测相似的图片, 避免重复插入
- [ ] **图片分类管理**: 根据图片内容或路径自动分类管理
- [ ] **图片标签自动生成**: 根据图片内容自动生成标签

## 2025.12.16

- [ ] 使用 org.intellij.plugins.markdown.lang.MarkdownFileType 来重构现在的 markdown 文件类型判断
- [ ] 使用 org.intellij.plugins.markdown.lang.psi.impl.MarkdownImage 来处理图片
- [ ] 将项目中本地的 MarkdownImage 重命名, 避免和 org.intellij.plugins.markdown.lang.psi.impl.MarkdownImage 冲突
- [ ] 添加一个类似 about me 的可折叠面板, 显示已集成的外部工具, 比如现在集成了 CleanShot X

## 2025.12.21

- [ ] 修复 webp 转换失效的问题

## 2025.12.30

- [ ] svg 快速打开 drawio 工具
- [ ] 自动更新
- [ ] 反馈面板